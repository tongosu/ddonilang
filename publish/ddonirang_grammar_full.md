# 또니랑 문법 총정리 (정본 요약)

> 기준: `docs/ssot/ssot/SSOT_LANG_v20.6.0.md`  
> 범위: AGE0(구 Gate0) 정본 중심. AGE1+ 확장은 별도 표기로 표시.

이 문서는 또니랑 문법을 **한 파일에 최대한 체계적으로 정리**한 요약본이다.  
정본/권위는 SSOT 문서이며, 이 문서는 **정본을 “쉽게 훑기 위한 총정리”**이다.

---

## 0) 표기/용어 규칙

- 표기 수준:
정본은 문서/예시/정본화 출력에 쓰는 **유일한 표기**이다.
별칭은 입력 호환을 위한 표기이며, 정본 출력에서는 제거/치환된다.
- 용어 정책:
정본 어휘는 순우리말을 우선하며, 영어/한자어는 별칭으로만 허용된다.
- 강도 표기:
`MUST`(필수), `SHOULD`(권장), `MAY`(선택).
- 핵심 원칙:
결정성(재현성)과 모호성 제거를 문법 단계에서 강제한다.
문서/예시에서 제네릭 꺾쇠 표기(`차림〈T〉`)는 금지한다.

---

## 1) 파일/토큰/기호 규칙

- 파일:
확장자 `.ddn`, UTF-8(BOM 없음 권장).
- 파일 메타:
`#키: 값` 형태의 메타 헤더를 허용한다.
- 주석:
`// ...` 한 줄 주석, `/* ... */` 블록 주석(중첩 금지).
- 기호의 의미는 고정:
`{}`는 **로직/범위(블록)**, `()`는 **데이터/설정(값/튜플/인자)**.
`$`는 말결(퍼지/강조) 토큰, `~`는 조사 경계, `@`는 단위/쓸감, `:`는 핀 고정 접미.
- `.`(점):
접근, 소수점, 문장 종결만 허용한다.

---

## 2) 식별자/예약어/원자

- 식별자:
한글/영문/숫자/밑줄 조합, 숫자 시작 불가.
- 원자(Atom):
`#대기`, `#공격`처럼 `#`로 시작하는 식별자. 컴파일 타임에 고정 ID로 변환.
- 시스템 예약 “자음 식별자”:
`ㄱ`~`ㅎ` 단자음/복자음 토큰은 사용자 정의 금지.
`ㅂ.` 같은 **시스템 뿌리 별칭**으로만 제한적으로 사용 가능.

예:
```ddn
바탕.중력 <- 9.8@mps2.
ㅂ.중력 <- 9.8@mps2.   // 바탕.의 별칭
```

---

## 3) 바탕(루트)와 바탕숨김

- 정본은 `바탕.` 접두를 명시한다.
- `#바탕숨김`은 입력 편의용이며, 정본 출력에서는 `바탕.`을 드러낸다.
- 바탕숨김 모드에서 새 바탕칸을 “조용히 생성”하는 행위는 금지/오류가 정본에 가깝다.

---

## 4) 문장 경계

- 기본 문장 경계는 **줄바꿈**이다.
- 한 줄에 여러 문장을 넣을 때만 `.`(종결점)을 사용한다.
- 세미콜론(`;`)은 사용하지 않는다.

---

## 5) 선언/정의/대입

- `=`는 **정의(Definition) 전용**.
- `<-`는 **대입(Assignment) 전용**.
- 설탕 대입:
`+<-`, `-<-`는 정본에서 `x <- x + y` 형태로 전개된다.

그릇채비/붙박이마련:
```ddn
그릇채비: {
  점수:수.
  중력:수 <- 9.8.
}.

붙박이마련: {
  원주율:수 = 3.141592.
}.
```

---

## 6) 씨앗 정의(움직씨/셈씨 등)

- 정의 기본형:
```ddn
(매개1:형~조사, 매개2:형~조사) 이름:움직씨 = { ... }.
(매개) 이름:셈씨:반환형 = { 결과 <- ... }.
```
- `()`는 매개(입력) 선언, `{}`는 본문(토막)이다.
- 셈씨는 **결과칸에 `<-`로 대입**하는 규칙을 사용한다.

주의:
`{}`를 인자 목록으로 사용하지 않는다. 인자는 `()`로만 전달한다.

---

## 7) 호출과 실행 꼬리

- 실행 꼬리:
`~기/~하기`, `~고/~하고`, `~면/~하면`은 **동치**다.
- 정본화는 입력 꼬리 스타일을 임의로 치환하지 않는다.
- 꼬리 없는 이름은 **값/이름**으로 해석되며 “호출”이 아니다.

예:
```ddn
(나) 회복하기.   // 호출
(나) 회복.       // 호출 아님
```

- `X`와 `X하`는 같은 스코프에서 동시 정의 불가(모호성 방지).

---

## 8) 조사/별칭 바인딩

- 매개변수 선언에서 조사 별칭을 붙일 수 있다.
```ddn
(A:수~을~를, B:수~이~가) 나누기:셈씨 = { 나누기 <- A / B }.
```
- 호출 바인딩 3가지:
이름 바인딩(`A=1`), 조사 바인딩(`1을`), 위치 바인딩(`(1,2)`).
- 정본 출력 우선순위:
조사 바인딩 > 핀 고정(`:핀`) > 위치 바인딩.
- 정본 출력은 조사 경계를 `~`로 명시한다.
- 한 호출문 안에서 바인딩 스타일 혼합은 금지한다.
- 접미 체인 순서:
`값 [@단위|@"자원"] [:핀] [~조사]`

예:
```ddn
100@m:거리~에서 이동하기.
```

---

## 9) 토막(블록)과 평가 표지

- `{ ... }`는 **토막(Thunk)** 이며, 평가 표지로 실행 시점을 고정한다.
- 정본 평가 표지:
`}한것`, `}인것`, `}아닌것`, `}하고`, `}해서`
- `}것` 중간 표기는 정본에서 제거한다.
- `-서` 파이프(`미분해서` 등)는 Gate0 문법에서 금지.

---

## 10) 파이프(`해서`)

- 파이프는 **호출식만** 허용한다.
- 정본은 `~기 해서` 또는 `~하기 해서`.
- 암묵 주입(implicit inject)은 금지.

예:
```ddn
(값) A하기 해서 B하기.
{ (값) A하기 }해서 B하기.
```

---

## 11) 분기/반복/머릿말

- `고르기:`는 **아니면 분기 필수**.
```ddn
고르기:
  { (x>0) }인것:
    "양수" 보여주기.
  아니면:
    "0 이하" 보여주기.
```
- `~해보고:`는 시도/바인딩. 결과는 `그것`에 바인딩된다.
- 반복:
`반복:`, `~동안:`, `~에 대해:`.
- 머릿말은 **닫힌 집합**이다. 임의의 머릿말 추가는 금지.
- `(임자)마다`, `(임자)모두`에서 `(임자)`는 블록 지역 변수다.

---

## 12) 계약(전제/보장)과 검사 훅

- 전제: `{P}인것 바탕으로`
- 보장: `{Q}인것 다짐하고`
- `아니면` 절 필수, `맞으면` 절 선택.
- 보장 위반 시 **수선 1회 + 재검사** 후 실패하면 중단.
- 검사 훅:
`(조건) 늘지켜보고 { ... }`는 읽기 전용, 불변성 검사에 사용한다.

---

## 13) 타입 체계(요약)

- 기본 알 타입과 복합 타입을 정의한다.
- 수치 정책:
`det_tier`, `trace_tier`로 결정성/추적 정책을 고정한다.
- `FIXED64_Q32_32`를 포함한 결정적 수치 타입을 정의한다.
- 타입 이름/구조는 정본 용어(순우리말)를 사용한다.

---

## 14) 값/구조 리터럴

- 글(문자열) `"..."`, 숫자 리터럴, 원자 리터럴 `#...`.
- 차림(배열) 리터럴:
AGE1+에서 `[]`, `[v1, v2]`는 값 위치에서만 허용.
타입 표기 위치에서 `수[]` 같은 표기는 금지.
- 텐서 입력 설탕:
`[[...],[...]]`는 `tensor.v0` 정준 표현으로 정본화한다.
- 묶음씨/레코드, 튜플, 고름씨(태그 유니온)를 지원한다.

---

## 15) 표현식/연산

- 말 이음씨(기호 없는 중위연산)와 기호 이음씨(확장 이음기호)를 지원한다.
- 사용자 정의 이음씨는 우선순위 규칙을 따라야 한다.
- `그리고/또는/아님`과 `&&/||`는 동치로 처리한다.

---

## 16) 단위/쓸감(자원)

- `@` 접미로 단위를 표기한다.
예: `10@cm`, `9.8@mps2`
- 쓸감 리터럴:
`@"경로/파일.png"` 형태.
- 단위 시스템은 차원 분석과 자동 환산 규칙을 포함한다.

---

## 17) 실행 어미와 말결

- 기본 서술 어미는 `~다.`.
- 말결(퍼지) 토큰은 `$` 정본을 사용한다.
예: `$매우`, `$조금`.

---

## 18) 반응형/이벤트 모델

- 흐름씨(스트림)와 일때씨(트리거)를 제공한다.
- `이전값보기`는 피드백/지연 규칙을 가진다.
- 알림(이벤트)은 닫힌 집합이며 `알리기`, `할때` 훅으로 연결된다.
- 훅/알림/시스템 실행 순서는 결정적으로 정렬된다.

---

## 19) 수식/글무늬/GOAP

### 19-1) 수식 `수식{...}` 체계

- 수식은 **입력/알맹이/표시** 삼층으로 분리한다.
입력은 말수식/ASCII/LaTeX 등 다양하지만, 내부는 **MathIR 하나**로 정규화된다.
- 표지는 `수식{...}` 하나만 사용한다. `[[...]]` 같은 별도 표지는 Gate0에서 금지.
- 방언 태그는 **Atom 태그**로만 구분한다.
정본 태그: `(#말)`, `(#ascii)`, `(#ascii1)`, `(#latex)`, `(#raytag)`, `(#그림)`.
- 태그 위치는 항상 **앞쪽 고정**이다.
정본: `(#ascii) 수식{ ... }`
금지: `수식{ ... } (#ascii)`
- 태그가 없으면 기본은 `#ascii`이다.

`#ascii` vs `#ascii1`:
- `#ascii`: 암묵 곱 금지, 곱셈은 `*`만 허용.
- `#ascii1`: 변수는 **영문 1글자(+숫자 첨자)만 허용**, 인접 항은 곱셈으로 해석.

예:
```ddn
높이 = (#ascii) 수식{ x0 + v0*t + (1/2)*a*t^2 }.
높이 = (#ascii1) 수식{ x0 + v0t + 1/2at^2 }.
```

본문 허용 범위(요약):
- `#ascii`, `#ascii1`: ASCII(0x20..0x7E) + 개행/탭만 허용.
- `#latex`: 유니코드 허용. Gate0에서 `풀기/미분하기/적분하기`는 **실행 불가**(표시/저장만).

결정성:
- 동일 의미의 수식은 **동일 MathIR**로 정규화되어야 한다.
- 수치 평가는 Fixed64 + 단위/차원 규칙을 따른다.

`풀기`(평가):
- 입력은 **named binding만 허용**한다. 예: `x=6`.
- 누락/여분/중복 키는 FATAL.
- 본문이 `식`이면 그 값을 반환하고, `이름 = 식`이면 RHS 값을 반환한다.
- 방정식 풀이(미지수 해 구하기)는 Gate0에서 하지 않는다.

정본 예:
```ddn
직선 = (#ascii) 수식{ y = 2*x + 3/2 }.
y2 = (x=6)인 직선 풀기.
```

`미분하기/적분하기`:
- 심볼릭 변환만 의미한다(수치 근사는 별도 규격).
- 호출은 `미분하기 해서`, `적분하기 해서`로 쓴다. `-서`는 금지.
- 옵션 묶음(최소): `변수`, `차수`, `상수포함`(적분).

---

### 19-2) 글무늬 `글무늬{...}` 체계

- 정본 표기는 `글무늬`다. `말무늬`는 정본 표기가 아니다.
- 문법: `(#태그)? 글무늬{ <본문> }`
본문은 `"..."` 한 개 또는 Raw 텍스트(멀티라인)이다.
- **특수블록 판정 규칙**: `글무늬{`는 공백 없이 붙여쓴다.
붙여쓰면 특수블록, 띄어쓰면 `글무늬` 씨앗 + `{...}` 토막으로 해석된다.

Raw 텍스트 정규화(요약):
1. 본문이 `\n`으로 시작하면 그 1개를 제거한다.
2. 본문이 `\n`으로 끝나면 그 1개를 제거한다.
3. 공통 최소 들여쓰기를 계산해 제거한다.
4. 줄 끝의 `\` 는 줄-이어쓰기로 처리한다.

자리표시자:
- 기본: `{키}`
- 포맷 포함: `{키|@포맷}`
- 이스케이프: `{{` → `{`, `}}` → `}`
- 키는 `이름` 또는 `이름.이름...` 경로를 허용한다.
루트 키는 **주입(핀묶음)** 으로 제공되어야 하고, 경로 중간에서 필드가 없으면 FATAL.
값이 `없음`이면 FATAL이며, 빈 글로 자동 치환하지 않는다.

`@포맷`:
- 자리표시자 내부에서만 해석한다.
- 너비: `@W` 또는 `@0W`
- 소수: `@.D` 또는 `@.DU`
- 반올림은 **ties-to-even** 고정.
- 로케일 장식(천단위, 지수표기 등)은 Gate0에서 금지.
- 타입/단위 불일치, 범위 위반은 FATAL.

채우기(렌더) 정본:
- 즉시 렌더: `(<키=값, ...>) 글무늬{...}`
- 무늬값 렌더: `(<키=값, ...>)인 무늬 채우기`
- `글무늬{...} 채우기`는 비문으로 금지.

예:
```ddn
(id=23, h=123.456@cm) 글무늬{"ID={id|@08}, 키={h|@.3m}"} 보여주기.
```

맞추기(패턴 매칭):
- AGE1+에서 `글무늬`를 패턴으로 사용해 값을 뽑는 기능이 추가된다.
- 결정적(모호성 없는) 매칭만 허용한다.

---

### 19-3) GOAP 목표 어미

- 목표 지향 계획 표기는 `-도록/-게`를 사용한다.

---

## 20) 누리 쿼리/군집

- 누리 쿼리 표현식과 필터 문법을 제공한다.
- 군집 제어는 `모두 {}` 설탕을 포함한다.

---

## 21) 결정성 핵심 규칙 요약

- 조건/검증 영역에서 운(Random) 소비 금지.
- 평가 순서 고정(좌→우).
- 단락 평가(short-circuit) 금지 영역 명시.
- 정본화는 불필요한 괄호 제거, 조사 경계 명시, 별칭 제거를 수행한다.

---

## 22) 비목표(Non-Goals)

- 모호성 허용 문법은 목표가 아니다.
- 정본과 충돌하는 “편의 설탕”은 제한적으로만 허용한다.

---

## 23) 정본 문서 안내

- `docs/ssot/ssot/SSOT_LANG_v20.6.0.md` : 언어 정본
- `docs/ssot/ssot/SSOT_TERMS_v20.6.0.md` : 용어/별칭 정본
- `docs/ssot/ssot/SSOT_DECISIONS_v20.6.0.md` : 결정 기록



---

## 부록 A) SSOT_LANG 핵심 결정(§0)과 AI 규칙(§0A)

### §0 핵심 결정 요약
- 문서/예시에서 제네릭 꺾쇠 표기(`차림〈T〉`) 금지.
- 말결 토큰은 `$`가 정본이며 `[]`는 말결 용도로 사용하지 않는다.
- `[]`/`[v1, v2]`는 AGE1+에서 값 위치에서만 허용하고, 타입 표기에서 `수[]`는 금지한다.
- 불변 훅 정본 키워드는 `늘지켜보고`다.
- 조사 자동 분리는 유지하며, 정본 출력은 `~`로 조사 경계를 고정한다.
- 정의와 호출을 분리하고, 호출은 꼬리(`~기/~하기`)로만 표현한다.
- 씨앗(익명함수) 리터럴 정본은 `{x | 식}`이며 `->`는 금지한다.
- 파이프는 `~기 해서`/`~하기 해서`만 허용하고 `-서`는 금지한다.
- 정본화는 의미가 변하지 않는 괄호를 제거한다.

### §0A AI/LLM 코드 생성 규칙 요약
- AI 출력은 정본 키워드만 사용한다.
- 계약은 `바탕으로/다짐하고`, 파이프는 `~기 해서`/`~하기 해서`로 고정한다.
- 토막 평가지시는 `}한것/}인것/}아닌것/}하고/}해서`만 사용한다.
- 꼬리 없는 이름은 호출로 쓰지 않는다.

---

## 부록 B) V18 통합 개정(§V18)과 TERM 맵(§TERM)

### §V18 핵심 요약
- 실행 꼬리 동치: `~기/~하기`, `~고/~하고`, `~면/~하면`은 AST 동치다.
- 호출 해석은 꼬리 분해 후보를 심볼 테이블로 확정한다. 후보 0개 또는 2개 이상은 오류다.
- 같은 스코프에서 `X`와 `X하` 동시 정의는 금지한다.
- 계약 기본형은 `바탕으로/다짐하고`이며 `아니면` 절은 필수다.
- 조건/검증 영역에서는 운(Random) 사용 금지, 평가 순서는 좌→우로 고정한다.
- 머릿말(HeadSpec)은 닫힌 집합이며 `고르기:`, `반복:`, `~동안:`, `~에 대해:` 같은 표준 머릿말만 허용한다.

### §TERM 요약
- 정본 용어는 1개만 두며 별칭은 입력 호환 용도다.
- TERM-MAP은 단일 소스이며 변경 정책과 FATAL/LEGACY를 포함한다.
- 기계 판독용 TERM-MAP 블록이 정본이다.

---

## 부록 C) 실행 어미(§11)와 파이프 의미론(§P1)

### 실행 어미 요약
- 기본 어미: `-다.`(종결), `-고`(순차), `-며`(병행).
- 확장 어미: `-거나`, `-다가`, `-려다`, `-채`, `-자마자`, `-도록`.
- 어간 별칭 `~`를 통해 불규칙 활용을 선언하고, 내부 정규형은 1개로 고정한다.
- 조사(`을/를`)와 어미(`ㄹ/을`)를 구분하며 모호하면 `:핀` 또는 `~조사`로 고정한다.

### 파이프 의미론 요약
- 파이프 단계는 호출식만 허용한다. 연산자 기반 임의식은 금지다.
- 흐름값은 좌→우로 전달되며, 이미 채워진 핀에는 주입하지 않는다.
- 주입 후보가 둘 이상이면 오류이며, 사용자가 핀을 명시해야 한다.
- `{ ... }해서`는 토막을 즉시 평가하여 다음 호출로 넘긴다.

---

## 부록 D) ID 규칙(§12)과 출력 규칙(§13), 다중 디스덧댐(§14)

### ID 규칙 요약
- 정규화: 모든 공백 제거, 영문 소문자화, NFC 정규화.
- ID 생성: XXH3 64-bit, 시드 0.
- 런타임 문자열 비교는 금지한다.

### 출력 규칙 요약
- 이야기는 `print/draw` 같은 직접 출력 호출을 하지 않는다.
- `"문장" 보여주기.`는 출력이 아니라 컴포넌트 생성 설탕이다.
- Transient/Persistent 수명을 구분하며, 보개가 관찰해 화면/콘솔에 반영한다.

### 다중 디스덧댐 요약
- 가장 구체적인 타입을 우선한다.
- 동률이면 컴파일 오류이며 선언 순서 타이브레이크는 금지한다.

---

## 부록 E) 검사 훅(§16), 말결(§17), GOAP(§18), 한국어성(§19)

### 검사 훅 요약
- `늘지켜보고`는 Patch 생성 후 Commit 직전에 실행한다.
- 검사 블록은 읽기 전용이며 `<-`, I/O, 난수 사용은 금지한다.
- `"사유" 덧댐거부`는 커밋을 취소하고 상태를 유지한다.

### 말결 요약
- 말결 토큰은 `$`로 시작하며 표준 가중치 매핑을 가진다.
- 기본값은 0.5이며, 문장 내 마지막 토큰이 적용된다.
- 부정어와 결합 시 부호가 반전된다.

### GOAP 요약
- 목표 어미는 `-도록/-게`를 사용한다.
- 목표는 GoalComponent로 표현되고 외부 플래너가 행동을 제안한다.

### 한국어성 요약
- 네임드/조사 바인딩은 인자 순서가 자유롭다.
- 생략 규칙은 옵션 A(생략 금지)가 정본이다.
- 기본값 인자는 정본화 단계에서 즉시 주입된다.

---

## 부록 F) 누리 쿼리(§23), Fixed64(§24), Reactive(§25), 쓸감/@(§26), PinSpec(§27)

### 누리 쿼리 요약
- 전수 스캔 금지, 아키타입 인덱싱을 사용한다.
- 결과는 `(realm_id, entity_id)` 오름차순으로 정렬된다.
- `임자들` 쿼리와 `모두 {}` 군집 실행을 제공한다.

### Fixed64 요약
- D-STRICT 원칙: 산술 오류는 결정적 값 + 고장 기록으로 처리한다.
- 덧셈/뺄셈/곱셈은 포화 산술을 사용한다.
- 0으로 나누기는 결과 0 + 해당 대입 무효화가 정본이다.
- DetMath 함수는 LUT 기반 결정론 구현만 허용한다.

### Reactive 요약
- 한 마디는 Update + Reactive 패스로 처리된다.
- Reactive는 패스 스냅샷 기준으로 처리하며, 순서를 결정적으로 고정한다.
- `ReactiveMaxPass` 상한을 초과하면 오류 또는 결정적 대체 정책을 적용한다.

### 쓸감/@ 요약
- 정본 표기는 `"경로" 쓸감.`이며 `@"경로"`는 문법 설탕이다.
- 단위 표기는 `숫자@단위` 전용이다.
- `@식별자`는 쓸감 리터럴이 아니다.

### PinSpec 요약
- 시그니처 정본 표기는 `(인자:타입~조사?, ...) 이름`이다.
- `?` 핀은 생략 가능하며 기본값이 없으면 `없음`으로 정규화된다.
- `~에 따라`는 옵션/고름씨 등 갈래형을 완전하게 분해하는 구조다.
- `.`의 공백 없는 사용은 멤버 접근 토큰이다.

---

## 부록 G) STDLIB(§C2)와 추가 규격

### STDLIB 요약
- 표준 핀 스펙 표기법과 핵심 함수 범위를 정의한다.
- 출력/알림/쓸감/목표/시간/난수/엔티티/컴포넌트/문자열 연산의 표준 시그니처를 고정한다.
- DetMath, 단위 시스템, 말결 매핑, 표준 컴포넌트 범위를 포함한다.
- 모듬 구조와 이름공간(모듬/가지) 정본화 규칙을 포함한다.

### 추가 규격 요약
- AI-GYM 전용 함수(끝내/지금관찰/보상) 규격.
- 말결 토큰 매핑과 DetMath LUT 정책.
- 입력키 표준 함수(compat/strict)와 글바꾸기 표준 함수.
- 매틱 진입 호환, 단위/쓸감 확장 규격.
- 확장 구문 프레임과 gaji 메타데이터/게이트 선언.
- 셈씨 결과칸 규칙, 파일 메타 헤더, 보개 계약 관련 규격.

---

## 정본 문서 안내(확장)

- `docs/ssot/ssot/SSOT_LANG_v20.6.0.md`
- `docs/ssot/ssot/SSOT_TERMS_v20.6.0.md`
- `docs/ssot/ssot/SSOT_DECISIONS_v20.6.0.md`
- `docs/ssot/ssot/SSOT_TOOLCHAIN_v20.6.0.md`
- `docs/ssot/ssot/SSOT_PLATFORM_v20.6.0.md`
