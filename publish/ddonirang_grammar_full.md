# 또니랑 문법 총정리 (정본 요약)

> 기준: `docs/ssot/ssot/SSOT_LANG_v20.6.0.md`  
> 범위: AGE0(구 Gate0) 정본 중심. AGE1+ 확장은 별도 표기로 표시.

이 문서는 또니랑 문법을 **한 파일에 최대한 체계적으로 정리**한 요약본이다.  
정본/권위는 SSOT 문서이며, 이 문서는 **정본을 “쉽게 훑기 위한 총정리”**이다.

---

## 0) 표기/용어 규칙

- 표기 수준:
정본은 문서/예시/정본화 출력에 쓰는 **유일한 표기**이다.
별칭은 입력 호환을 위한 표기이며, 정본 출력에서는 제거/치환된다.
- 용어 정책:
정본 어휘는 순우리말을 우선하며, 영어/한자어는 별칭으로만 허용된다.
- 강도 표기:
`MUST`(필수), `SHOULD`(권장), `MAY`(선택).
- 핵심 원칙:
결정성(재현성)과 모호성 제거를 문법 단계에서 강제한다.
문서/예시에서 제네릭 꺾쇠 표기(`차림〈T〉`)는 금지한다.

---

## 1) 파일/토큰/기호 규칙

- 파일:
확장자 `.ddn`, UTF-8(BOM 없음 권장).
- 파일 메타:
`#키: 값` 형태의 메타 헤더를 허용한다.
- 주석:
`// ...` 한 줄 주석, `/* ... */` 블록 주석(중첩 금지).
- 기호의 의미는 고정:
`{}`는 **로직/범위(블록)**, `()`는 **데이터/설정(값/튜플/인자)**.
`$`는 말결(퍼지/강조) 토큰, `~`는 조사 경계, `@`는 단위/쓸감, `:`는 핀 고정 접미.
- `.`(점):
접근, 소수점, 문장 종결만 허용한다.

---

## 2) 식별자/예약어/원자

- 식별자:
한글/영문/숫자/밑줄 조합, 숫자 시작 불가.
- 원자(Atom):
`#대기`, `#공격`처럼 `#`로 시작하는 식별자. 컴파일 타임에 고정 ID로 변환.
- 시스템 예약 “자음 식별자”:
`ㄱ`~`ㅎ` 단자음/복자음 토큰은 사용자 정의 금지.
`ㅂ.` 같은 **시스템 뿌리 별칭**으로만 제한적으로 사용 가능.

예:
```ddn
바탕.중력 <- 9.8@mps2.
ㅂ.중력 <- 9.8@mps2.   // 바탕.의 별칭
```

---

## 3) 바탕(루트)와 바탕숨김

- 정본은 `바탕.` 접두를 명시한다.
- `#바탕숨김`은 입력 편의용이며, 정본 출력에서는 `바탕.`을 드러낸다.
- 바탕숨김 모드에서 새 바탕칸을 “조용히 생성”하는 행위는 금지/오류가 정본에 가깝다.

---

## 4) 문장 경계

- 기본 문장 경계는 **줄바꿈**이다.
- 한 줄에 여러 문장을 넣을 때만 `.`(종결점)을 사용한다.
- 세미콜론(`;`)은 사용하지 않는다.

---

## 5) 선언/정의/대입

- `=`는 **정의(Definition) 전용**.
- `<-`는 **대입(Assignment) 전용**.
- 설탕 대입:
`+<-`, `-<-`는 정본에서 `x <- x + y` 형태로 전개된다.

그릇채비/붙박이마련:
```ddn
그릇채비: {
  점수:수.
  중력:수 <- 9.8.
}.

붙박이마련: {
  원주율:수 = 3.141592.
}.
```

---

## 6) 씨앗 정의(움직씨/셈씨 등)

- 정의 기본형:
```ddn
(매개1:형~조사, 매개2:형~조사) 이름:움직씨 = { ... }.
(매개) 이름:셈씨:반환형 = { 결과 <- ... }.
```
- `()`는 매개(입력) 선언, `{}`는 본문(토막)이다.
- 셈씨는 **결과칸에 `<-`로 대입**하는 규칙을 사용한다.

주의:
`{}`를 인자 목록으로 사용하지 않는다. 인자는 `()`로만 전달한다.

---

## 7) 호출과 실행 꼬리

- 실행 꼬리:
`~기/~하기`, `~고/~하고`, `~면/~하면`은 **동치**다.
- 정본화는 입력 꼬리 스타일을 임의로 치환하지 않는다.
- 꼬리 없는 이름은 **값/이름**으로 해석되며 “호출”이 아니다.

예:
```ddn
(나) 회복하기.   // 호출
(나) 회복.       // 호출 아님
```

- `X`와 `X하`는 같은 스코프에서 동시 정의 불가(모호성 방지).

---

## 8) 조사/별칭 바인딩

- 매개변수 선언에서 조사 별칭을 붙일 수 있다.
```ddn
(A:수~을~를, B:수~이~가) 나누기:셈씨 = { 나누기 <- A / B }.
```
- 호출 바인딩 3가지:
이름 바인딩(`A=1`), 조사 바인딩(`1을`), 위치 바인딩(`(1,2)`).
- 정본 출력 우선순위:
조사 바인딩 > 핀 고정(`:핀`) > 위치 바인딩.
- 정본 출력은 조사 경계를 `~`로 명시한다.
- 한 호출문 안에서 바인딩 스타일 혼합은 금지한다.
- 접미 체인 순서:
`값 [@단위|@"자원"] [:핀] [~조사]`

예:
```ddn
100@m:거리~에서 이동하기.
```

---

## 9) 토막(블록)과 평가 표지

- `{ ... }`는 **토막(Thunk)** 이며, 평가 표지로 실행 시점을 고정한다.
- 정본 평가 표지:
`}한것`, `}인것`, `}아닌것`, `}하고`, `}해서`
- `}것` 중간 표기는 정본에서 제거한다.
- `-서` 파이프(`미분해서` 등)는 Gate0 문법에서 금지.

---

## 10) 파이프(`해서`)

- 파이프는 **호출식만** 허용한다.
- 정본은 `~기 해서` 또는 `~하기 해서`.
- 암묵 주입(implicit inject)은 금지.

예:
```ddn
(값) A하기 해서 B하기.
{ (값) A하기 }해서 B하기.
```

---

## 11) 분기/반복/머릿말

- `고르기:`는 **아니면 분기 필수**.
```ddn
고르기:
  { (x>0) }인것:
    "양수" 보여주기.
  아니면:
    "0 이하" 보여주기.
```
- `~해보고:`는 시도/바인딩. 결과는 `그것`에 바인딩된다.
- 반복:
`반복:`, `~동안:`, `~에 대해:`.
- 머릿말은 **닫힌 집합**이다. 임의의 머릿말 추가는 금지.
- `(임자)마다`, `(임자)모두`에서 `(임자)`는 블록 지역 변수다.

---

## 12) 계약(전제/보장)과 검사 훅

- 전제: `{P}인것 바탕으로`
- 보장: `{Q}인것 다짐하고`
- `아니면` 절 필수, `맞으면` 절 선택.
- 보장 위반 시 **수선 1회 + 재검사** 후 실패하면 중단.
- 검사 훅:
`(조건) 늘지켜보고 { ... }`는 읽기 전용, 불변성 검사에 사용한다.

---

## 13) 타입 체계(요약)

- 기본 알 타입과 복합 타입을 정의한다.
- 수치 정책:
`det_tier`, `trace_tier`로 결정성/추적 정책을 고정한다.
- `FIXED64_Q32_32`를 포함한 결정적 수치 타입을 정의한다.
- 타입 이름/구조는 정본 용어(순우리말)를 사용한다.

---

## 14) 값/구조 리터럴

- 글(문자열) `"..."`, 숫자 리터럴, 원자 리터럴 `#...`.
- 차림(배열) 리터럴:
AGE1+에서 `[]`, `[v1, v2]`는 값 위치에서만 허용.
타입 표기 위치에서 `수[]` 같은 표기는 금지.
- 텐서 입력 설탕:
`[[...],[...]]`는 `tensor.v0` 정준 표현으로 정본화한다.
- 묶음씨/레코드, 튜플, 고름씨(태그 유니온)를 지원한다.

---

## 15) 표현식/연산

- 말 이음씨(기호 없는 중위연산)와 기호 이음씨(확장 이음기호)를 지원한다.
- 사용자 정의 이음씨는 우선순위 규칙을 따라야 한다.
- `그리고/또는/아님`과 `&&/||`는 동치로 처리한다.

---

## 16) 단위/쓸감(자원)

- `@` 접미로 단위를 표기한다.
예: `10@cm`, `9.8@mps2`
- 쓸감 리터럴:
`@"경로/파일.png"` 형태.
- 단위 시스템은 차원 분석과 자동 환산 규칙을 포함한다.

---

## 17) 실행 어미와 말결

- 기본 서술 어미는 `~다.`.
- 말결(퍼지) 토큰은 `$` 정본을 사용한다.
예: `$매우`, `$조금`.

---

## 18) 반응형/이벤트 모델

- 흐름씨(스트림)와 일때씨(트리거)를 제공한다.
- `이전값보기`는 피드백/지연 규칙을 가진다.
- 알림(이벤트)은 닫힌 집합이며 `알리기`, `할때` 훅으로 연결된다.
- 훅/알림/시스템 실행 순서는 결정적으로 정렬된다.

---

## 19) 수식/글무늬/GOAP

### 19-1) 수식 `수식{...}` 체계

- 수식은 **입력/알맹이/표시** 삼층으로 분리한다.
입력은 말수식/ASCII/LaTeX 등 다양하지만, 내부는 **MathIR 하나**로 정규화된다.
- 표지는 `수식{...}` 하나만 사용한다. `[[...]]` 같은 별도 표지는 Gate0에서 금지.
- 방언 태그는 **Atom 태그**로만 구분한다.
정본 태그: `(#말)`, `(#ascii)`, `(#ascii1)`, `(#latex)`, `(#raytag)`, `(#그림)`.
- 태그 위치는 항상 **앞쪽 고정**이다.
정본: `(#ascii) 수식{ ... }`
금지: `수식{ ... } (#ascii)`
- 태그가 없으면 기본은 `#ascii`이다.

`#ascii` vs `#ascii1`:
- `#ascii`: 암묵 곱 금지, 곱셈은 `*`만 허용.
- `#ascii1`: 변수는 **영문 1글자(+숫자 첨자)만 허용**, 인접 항은 곱셈으로 해석.

예:
```ddn
높이 = (#ascii) 수식{ x0 + v0*t + (1/2)*a*t^2 }.
높이 = (#ascii1) 수식{ x0 + v0t + 1/2at^2 }.
```

본문 허용 범위(요약):
- `#ascii`, `#ascii1`: ASCII(0x20..0x7E) + 개행/탭만 허용.
- `#latex`: 유니코드 허용. Gate0에서 `풀기/미분하기/적분하기`는 **실행 불가**(표시/저장만).

결정성:
- 동일 의미의 수식은 **동일 MathIR**로 정규화되어야 한다.
- 수치 평가는 Fixed64 + 단위/차원 규칙을 따른다.

`풀기`(평가):
- 입력은 **named binding만 허용**한다. 예: `x=6`.
- 누락/여분/중복 키는 FATAL.
- 본문이 `식`이면 그 값을 반환하고, `이름 = 식`이면 RHS 값을 반환한다.
- 방정식 풀이(미지수 해 구하기)는 Gate0에서 하지 않는다.

정본 예:
```ddn
직선 = (#ascii) 수식{ y = 2*x + 3/2 }.
y2 = (x=6)인 직선 풀기.
```

`미분하기/적분하기`:
- 심볼릭 변환만 의미한다(수치 근사는 별도 규격).
- 호출은 `미분하기 해서`, `적분하기 해서`로 쓴다. `-서`는 금지.
- 옵션 묶음(최소): `변수`, `차수`, `상수포함`(적분).

---

### 19-2) 글무늬 `글무늬{...}` 체계

- 정본 표기는 `글무늬`다. `말무늬`는 정본 표기가 아니다.
- 문법: `(#태그)? 글무늬{ <본문> }`
본문은 `"..."` 한 개 또는 Raw 텍스트(멀티라인)이다.
- **특수블록 판정 규칙**: `글무늬{`는 공백 없이 붙여쓴다.
붙여쓰면 특수블록, 띄어쓰면 `글무늬` 씨앗 + `{...}` 토막으로 해석된다.

Raw 텍스트 정규화(요약):
1. 본문이 `\n`으로 시작하면 그 1개를 제거한다.
2. 본문이 `\n`으로 끝나면 그 1개를 제거한다.
3. 공통 최소 들여쓰기를 계산해 제거한다.
4. 줄 끝의 `\` 는 줄-이어쓰기로 처리한다.

자리표시자:
- 기본: `{키}`
- 포맷 포함: `{키|@포맷}`
- 이스케이프: `{{` → `{`, `}}` → `}`
- 키는 `이름` 또는 `이름.이름...` 경로를 허용한다.
루트 키는 **주입(핀묶음)** 으로 제공되어야 하고, 경로 중간에서 필드가 없으면 FATAL.
값이 `없음`이면 FATAL이며, 빈 글로 자동 치환하지 않는다.

`@포맷`:
- 자리표시자 내부에서만 해석한다.
- 너비: `@W` 또는 `@0W`
- 소수: `@.D` 또는 `@.DU`
- 반올림은 **ties-to-even** 고정.
- 로케일 장식(천단위, 지수표기 등)은 Gate0에서 금지.
- 타입/단위 불일치, 범위 위반은 FATAL.

채우기(렌더) 정본:
- 즉시 렌더: `(<키=값, ...>) 글무늬{...}`
- 무늬값 렌더: `(<키=값, ...>)인 무늬 채우기`
- `글무늬{...} 채우기`는 비문으로 금지.

예:
```ddn
(id=23, h=123.456@cm) 글무늬{"ID={id|@08}, 키={h|@.3m}"} 보여주기.
```

맞추기(패턴 매칭):
- AGE1+에서 `글무늬`를 패턴으로 사용해 값을 뽑는 기능이 추가된다.
- 결정적(모호성 없는) 매칭만 허용한다.

---

### 19-3) GOAP 목표 어미

- 목표 지향 계획 표기는 `-도록/-게`를 사용한다.

---

## 20) 누리 쿼리/군집

- 누리 쿼리 표현식과 필터 문법을 제공한다.
- 군집 제어는 `모두 {}` 설탕을 포함한다.

---

## 21) 결정성 핵심 규칙 요약

- 조건/검증 영역에서 운(Random) 소비 금지.
- 평가 순서 고정(좌→우).
- 단락 평가(short-circuit) 금지 영역 명시.
- 정본화는 불필요한 괄호 제거, 조사 경계 명시, 별칭 제거를 수행한다.

---

## 22) 비목표(Non-Goals)

- 모호성 허용 문법은 목표가 아니다.
- 정본과 충돌하는 “편의 설탕”은 제한적으로만 허용한다.

---

## 23) 정본 문서 안내

- `docs/ssot/ssot/SSOT_LANG_v20.6.0.md` : 언어 정본
- `docs/ssot/ssot/SSOT_TERMS_v20.6.0.md` : 용어/별칭 정본
- `docs/ssot/ssot/SSOT_DECISIONS_v20.6.0.md` : 결정 기록
